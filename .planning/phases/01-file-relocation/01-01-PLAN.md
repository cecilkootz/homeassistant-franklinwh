---
phase: 01-file-relocation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - custom_components/franklin_wh/__init__.py
  - custom_components/franklin_wh/config_flow.py
  - custom_components/franklin_wh/const.py
  - custom_components/franklin_wh/coordinator.py
  - custom_components/franklin_wh/diagnostics.py
  - custom_components/franklin_wh/sensor.py
  - custom_components/franklin_wh/switch.py
  - custom_components/franklin_wh/manifest.json
  - custom_components/franklin_wh/strings.json
  - custom_components/franklin_wh/services.yaml
  - custom_components/franklin_wh/translations/en.json
  - hacs.json
autonomous: true
requirements:
  - FILE-01
  - FILE-02
  - FILE-03
  - FILE-04
  - FILE-05
  - FILE-06
  - FILE-07
  - FILE-08
  - FILE-09
  - FILE-10
  - FILE-11
  - FILE-12
  - CONF-01
  - CONF-02
  - CONF-03

must_haves:
  truths:
    - "custom_components/franklin_wh/ contains all 11 integration files (7 Python + manifest.json + strings.json + services.yaml + translations/en.json)"
    - "Repository root contains no loose Python files, no loose integration JSON/YAML files"
    - "hacs.json contains only the 'name' key — no content_in_root, no zip_release"
    - "All file moves and hacs.json edit land in exactly one atomic git commit"
    - "Git history is preserved (renames tracked, not new files)"
  artifacts:
    - path: "custom_components/franklin_wh/__init__.py"
      provides: "Python integration entry point (relocated)"
    - path: "custom_components/franklin_wh/manifest.json"
      provides: "HACS integration manifest (relocated)"
    - path: "custom_components/franklin_wh/translations/en.json"
      provides: "English translations (relocated)"
    - path: "hacs.json"
      provides: "HACS repo config — name only, no workaround keys"
  key_links:
    - from: "hacs.json"
      to: "custom_components/franklin_wh/"
      via: "HACS standard discovery (no content_in_root)"
      pattern: "\"name\": \"FranklinWH\""
---

<objective>
Move all 11 integration files from the repository root into `custom_components/franklin_wh/` using `git mv` (history-preserving), update `hacs.json` to remove the `content_in_root` and `zip_release` workaround keys, and land everything in a single atomic commit.

Purpose: Make the repository HACS-compliant by placing integration files at the standard discovery path. HACS will find the integration without any `content_in_root` workaround.
Output: One atomic git commit containing all 12 file renames and the hacs.json edit.
</objective>

<execution_context>
@/Users/matt/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-file-relocation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move all integration files via git mv and update hacs.json</name>
  <files>
    custom_components/franklin_wh/__init__.py
    custom_components/franklin_wh/config_flow.py
    custom_components/franklin_wh/const.py
    custom_components/franklin_wh/coordinator.py
    custom_components/franklin_wh/diagnostics.py
    custom_components/franklin_wh/sensor.py
    custom_components/franklin_wh/switch.py
    custom_components/franklin_wh/manifest.json
    custom_components/franklin_wh/strings.json
    custom_components/franklin_wh/services.yaml
    custom_components/franklin_wh/translations/en.json
    hacs.json
  </files>
  <action>
Run all commands from the repository root. Use `set -e` so any failure stops immediately before committing.

```bash
set -e

# Create destination directory (git mv does not create intermediate directories)
mkdir -p custom_components/franklin_wh/translations

# Move Python files (FILE-02 through FILE-08)
git mv __init__.py        custom_components/franklin_wh/__init__.py
git mv config_flow.py     custom_components/franklin_wh/config_flow.py
git mv const.py           custom_components/franklin_wh/const.py
git mv coordinator.py     custom_components/franklin_wh/coordinator.py
git mv diagnostics.py     custom_components/franklin_wh/diagnostics.py
git mv sensor.py          custom_components/franklin_wh/sensor.py
git mv switch.py          custom_components/franklin_wh/switch.py

# Move JSON and YAML config files (FILE-09 through FILE-11)
git mv manifest.json      custom_components/franklin_wh/manifest.json
git mv strings.json       custom_components/franklin_wh/strings.json
git mv services.yaml      custom_components/franklin_wh/services.yaml

# Move translations (FILE-12)
git mv translations/en.json custom_components/franklin_wh/translations/en.json
```

Then update hacs.json using Python to avoid manual JSON editing errors (CONF-01, CONF-02):

```python
import json
with open('hacs.json') as f:
    d = json.load(f)
d.pop('content_in_root', None)
d.pop('zip_release', None)
with open('hacs.json', 'w') as f:
    json.dump(d, f, indent=2)
    f.write('\n')
```

DO NOT use `cp` + `git rm` — that loses rename history.
DO NOT move `hacs.json`, `README.md`, `LICENSE`, or anything in `.github/`.
DO NOT commit yet — Task 2 handles the commit after verification.
  </action>
  <verify>
    <automated>
      git status --short | grep -E "^R" | wc -l | grep -q "11" && echo "11 renames staged" || echo "WRONG rename count"
      python3 -m json.tool hacs.json > /dev/null && echo "hacs.json valid JSON"
      python3 -c "import json; d=json.load(open('hacs.json')); assert 'content_in_root' not in d; assert 'zip_release' not in d; assert d.get('name')=='FranklinWH'; print('hacs.json correct')"
    </automated>
  </verify>
  <done>
    - `git status` shows exactly 11 renames staged (R entries) and hacs.json as modified (M)
    - `hacs.json` contains only `{"name": "FranklinWH"}` and is valid JSON
    - No Python, YAML, or integration JSON files remain at the repository root
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify clean state and create atomic commit</name>
  <files>
    (no new files — commit operation only)
  </files>
  <action>
Before committing, run these verification checks. If any check fails, stop and fix before committing.

```bash
# Check 1: Confirm 11 files landed in target directory
find custom_components/franklin_wh -type f | sort
# Expected 11 files:
# custom_components/franklin_wh/__init__.py
# custom_components/franklin_wh/config_flow.py
# custom_components/franklin_wh/const.py
# custom_components/franklin_wh/coordinator.py
# custom_components/franklin_wh/diagnostics.py
# custom_components/franklin_wh/manifest.json
# custom_components/franklin_wh/sensor.py
# custom_components/franklin_wh/services.yaml
# custom_components/franklin_wh/strings.json
# custom_components/franklin_wh/switch.py
# custom_components/franklin_wh/translations/en.json

# Check 2: Confirm no stray integration files remain at root
# (should produce no output — no .py or non-hacs .json or .yaml at root)
ls *.py 2>/dev/null && echo "ERROR: Python files still at root" || echo "Root clear of .py"
ls *.yaml 2>/dev/null && echo "ERROR: YAML files still at root" || echo "Root clear of .yaml"

# Check 3: Confirm hacs.json is staged
git diff --cached --name-only | grep hacs.json && echo "hacs.json staged" || echo "ERROR: hacs.json not staged"
```

If all checks pass, stage hacs.json (it was edited, not git mv'd) and commit atomically (CONF-03):

```bash
git add hacs.json
git commit -m "refactor: migrate files to custom_components/franklin_wh/ for HACS compliance"
```

The commit message is pre-determined — do not change it.
  </action>
  <verify>
    <automated>
      git log --oneline -1 | grep "migrate files to custom_components"
      git show --stat HEAD | grep "11 files changed"
      git show HEAD:hacs.json | python3 -c "import json,sys; d=json.load(sys.stdin); assert list(d.keys())==['name']; print('hacs.json correct in commit')"
      find custom_components/franklin_wh -type f | sort | wc -l | grep -q "11" && echo "11 files in target dir"
    </automated>
  </verify>
  <done>
    - `git log --oneline -1` shows the migration commit
    - `git show --stat HEAD` shows 11 renames + 1 modification (hacs.json) = 12 file changes
    - `git show HEAD:hacs.json` contains only `{"name": "FranklinWH"}`
    - `find custom_components/franklin_wh -type f | wc -l` returns 11
    - Repository root has no loose Python, YAML, or integration JSON files
  </done>
</task>

</tasks>

<verification>
After both tasks complete, confirm the phase success criteria from ROADMAP.md:

1. `find custom_components/franklin_wh -type f | sort` — shows exactly 11 files
2. `ls *.py *.yaml 2>/dev/null` — produces no output (root is clean)
3. `cat hacs.json` — shows `{"name": "FranklinWH"}` only
4. `git log --oneline -1` — shows the single migration commit
5. `git show --stat HEAD | grep "files changed"` — shows 12 changes (11 renames + hacs.json edit)
</verification>

<success_criteria>
- `custom_components/franklin_wh/` contains exactly 11 files matching the target structure
- Repository root contains only `README.md`, `hacs.json`, `LICENSE`, and `.github/`
- `hacs.json` has no `content_in_root` key and no `zip_release` key
- All changes land in exactly one git commit with rename history preserved
</success_criteria>

<output>
After completion, create `.planning/phases/01-file-relocation/01-01-SUMMARY.md` using the summary template at `@/Users/matt/.claude/get-shit-done/templates/summary.md`.
</output>
